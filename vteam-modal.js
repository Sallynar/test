!function(e,o){"use strict";function s(e,t,i,n,s,o){var a=e;return i&&(a+="_"+i,n&&(a+="_"+n)),t&&(a+="__"+t,s&&(a+="_"+s,o&&(a+="_"+o))),a}function a(){this._block=null,this._elem=null,this._mods={},this._elemMods={},this._mix=[]}a.prototype.block=function(e){return this._block=e,this},a.prototype.elem=function(e){return this._elem=e,this},a.prototype.mod=function(e,t){return e&&(null===t||!1===t?delete this._mods[e]:this._mods[e]=!0===t?"":t),this},a.prototype.elemMod=function(e,t){return e&&(null===t||!1===t?delete this._elemMods[e]:this._elemMods[e]=!0===t?"":t),this},a.prototype.mix=function(e){return Array.isArray(e)||(e=[e]),e.forEach(function(e){this._mix.push((new a).block(e.block).elem(e.elem).mod(e.modName,e.modVal).elemMod(e.elemModName,e.elemModVal))},this),this},a.prototype.toString=a.prototype.valueOf=function(){var n=[s(this._block,this._elem)];Object.keys(this._elem?this._elemMods:this._mods).forEach(function(e){var t=(this._elem?this._elemMods:this._mods)[e],i=[this._block,this._elem];this._elem&&i.push(null,null),i.push(e,t),n.push(s.apply(null,i))},this);var e=this._mix.map(function(e){return e.toString()});return n.concat(e).join(" ")},a.mod=function(e,t,i,n){null===n||!1===n?e.classList.remove(s(t,null,i,n)):e.classList.add(s(t,null,i,!0===n?"":n))};var r={header:function(e){var t=o.createDocumentFragment(),i=o.createElement("div"),n=e.issues+" "+function(e,t,i,n){3===arguments.length&&(n=i);if(-1!==[11,12,13,14].indexOf(e%100))return n;if(e%10==1)return t;if(-1!==[2,3,4].indexOf(e%10))return i;return n}(e.issues,"задача","задачи","задач");return e.series&&(n=e.series+" · "+n),i.className=(new a).block("vteam-modal").elem("title"),i.appendChild(o.createTextNode(e.date)),t.appendChild(i),t.appendChild(o.createTextNode(n)),t},details:{list:function(e){var i=o.createElement("ol");return i.className=(new a).block("vteam-list"),(e||[]).forEach(function(e){if(0!==Object.keys(Object(e)).length){var t=this.item(e,"li");t.className+=(new a).mix({block:"vteam-list",elem:"item"}),i.appendChild(t)}},this),i},item:function(e,t){var i=o.createElement(t||"div");if(i.className=(new a).block("vteam-details"),e.header){var n=o.createElement("header");n.className=(new a).block("vteam-details").elem("header"),l(n,e.header),i.appendChild(n)}return(e.rows||[]).forEach(function(e){0!==Object.keys(Object(e)).length&&i.appendChild(this.row(e))},this),i},row:function(e){var t=o.createElement("div");return t.className=(new a).block("vteam-details").elem("row"),e.badge&&t.appendChild(this.badge(e.badge)),e.label&&t.appendChild(this.label(e.label)),t.appendChild(this.value(e.value)),e.rows&&t.appendChild(this.item({rows:e.rows})),t},badge:function(e){var t=o.createElement("div");return t.className=(new a).block("vteam-details").elem("badge"),t.innerText=e.text,e.color&&(t.style.backgroundColor=e.color),t},label:function(e){var t=o.createElement("div");return t.className=(new a).block("vteam-details").elem("label"),t.innerText=e,t},value:function(e){var t=o.createElement("div");return t.className=(new a).block("vteam-details").elem("value"),l(t,e),t}},footer:function(e){var t=o.createElement("footer");return t.className=(new a).block("vteam-modal").elem("footer"),t.appendChild(r.details.item(e)),t},stLink:function(e){var t=o.createElement("a"),i=o.createTextNode(e.key),n=o.createElement("span"),s=o.createTextNode(e.summary);return n.className=(new a).block("vteam-st-link").elem("status"),n.innerText=e.status,t.className=(new a).block("vteam-st-link"),t.setAttribute("href","https://st.yandex-team.ru/"+e.key),t.setAttribute("target","_blank"),t.appendChild(i),t.appendChild(n),t.appendChild(s),e.assignee&&t.appendChild(this.userLink(e.assignee)),t},userLink:function(e){var t=o.createElement("a");return t.className=(new a).block("vteam-st-link").elem("user").mix({block:"vteam-user"}),t.innerText=e,t.setAttribute("href","https://staff.yandex-team.ru/"+e),t.setAttribute("target","_blank"),t}};function l(t,e){var i=function(e){e.forEach(function(e){if(Array.isArray(e))return i(e);if(-1===["string","number"].indexOf(typeof e))try{t.appendChild(e)}catch(e){}else t.innerHTML+=e},this)}.bind(this);i([e])}var t=!(a.hasMod=function(e,t,i,n){return e.classList.contains(s(t,null,i,n))}),i=!1,n=!1,d=null;function m(){this.init()}m.prototype.init=function(){if(!t){t=!0,Object.defineProperty(this,"visible",{enumerable:!0,get:function(){return!a.hasMod(this.dom.main,"vteam-modal","hidden")}.bind(this)}),this.dom={main:o.createElement("div"),header:o.createElement("header"),dismiss:o.createElement("button"),content:o.createElement("div"),styles:o.createElement("link")},this.dom.styles.setAttribute("rel","stylesheet"),this.dom.styles.setAttribute("type","text/css"),this.dom.styles.setAttribute("href",function(){for(var e=o.getElementsByTagName("script"),t=0,i=e.length;t<i;t++){var n=e[t].src.split("vteam-modal.js");if(2===n.length)return n[0]}}()+"vteam-modal.css"),this.dom.content.className=(new a).block("vteam-modal").elem("content"),this.dom.content.setAttribute("role","document"),this.dom.dismiss.className=(new a).block("vteam-modal").elem("dismiss"),this.dom.dismiss.innerHTML="×",this.dom.dismiss.setAttribute("title","Закрыть"),this.dom.header.className=(new a).block("vteam-modal").elem("header"),this.dom.header.setAttribute("role","heading"),this.dom.main.className=(new a).block("vteam-modal").mod("hidden"),this.dom.main.setAttribute("tabindex","-1"),this.dom.main.setAttribute("role","complementary"),this.dom.main.setAttribute("aria-hidden","true"),this.dom.main.appendChild(this.dom.header),this.dom.main.appendChild(this.dom.dismiss),this.dom.main.appendChild(this.dom.content),this._attachEvents();var e=o.querySelector("body");e.appendChild(this.dom.styles),e.appendChild(this.dom.main)}},m.prototype.destroy=function(){t&&(t=!1,this._detachEvents(),this.dom.main.parentNode.removeChild(this.dom.main),this.dom.styles.parentNode.removeChild(this.dom.styles),this.dom=null)},m.prototype._attachEvents=function(){if(!i){i=!0;this.onKeyDown=function(e){this.visible&&27===e.keyCode&&(e.stopImmediatePropagation(),this.dismiss())}.bind(this),this.onWindowClick=function(e){this.visible&&!n&&e.target.offsetParent!==this.dom.main&&this.dismiss()}.bind(this),e.addEventListener("keydown",this.onKeyDown),e.addEventListener("click",this.onWindowClick),this.dom.dismiss.addEventListener("click",function(){this.dismiss()}.bind(this))}},m.prototype._detachEvents=function(){i&&(i=!1,e.removeEventListener("keydown",this.onKeyDown),e.removeEventListener("click",this.onWindowClick))},m.prototype._show=function(){a.mod(this.dom.main,"vteam-modal","hidden",!1),this.dom.main.setAttribute("aria-hidden","false"),d=o.activeElement,this.dom.main.focus()},m.prototype._hide=function(){a.mod(this.dom.main,"vteam-modal","hidden",!0),this.dom.main.setAttribute("aria-hidden","true"),d&&(d.focus(),d=null)},m.prototype._preventOuterClickDismiss=function(){n||(n=!0,setTimeout(function(){n=!1}))},m.prototype._setContent=function(e){var t,i,n;this._clear(),l(this.dom.header,(t=e,r.header(t.header))),l(this.dom.content,(i=e,n=o.createDocumentFragment(),i.details&&n.appendChild(r.details.item({rows:i.details})),i.issues&&n.appendChild(r.details.list(i.issues.map(function(e){return{header:r.stLink(e.issue),rows:e.rows}}))),i.footer&&n.appendChild(r.footer(i.footer)),n))},m.prototype._clear=function(){this.dom.header.innerHTML="",this.dom.content.innerHTML=""},m.prototype.open=function(e){this._setContent(e),this._show(),this._preventOuterClickDismiss()},m.prototype.dismiss=function(){this._hide(),setTimeout(function(){this.visible||this._clear()}.bind(this),200)},e.vTeamModal=e.vTeamModal||new m}(window,document);